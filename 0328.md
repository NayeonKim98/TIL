# CS50: SQL 수업 정리

## Relational Databases (관계형 데이터베이스)

### "엑셀보다 똑똑한 데이터 저장소"
- 관계형 데이터베이스는 데이터를 표(table) 형태로 저장하며, 서로 연결된 관계를 통해 더 유연하게 정보를 다룰 수 있다.

### 엑셀에 비유하자면?
| 🧮 스프레드시트(엑셀) | 🗃️ 관계형 데이터베이스 |
|--------------------|-------------------------|
| 시트 (sheet)        | 테이블 (table)           |
| 셀 (cell)           | 필드 (field)             |
| 행 (row)            | 레코드 (record)          |
| 열 (column)         | 컬럼 (column)            |
- 여러가지 시트를 서로 연결해 쓸 수 있다는 강점.

### SQL로 할 수 있는 핵심 작업 : CRUD
| 작업 (Operation) | SQL 명령어 (SQL Command) | 설명 (Description)              |
|------------------|---------------------------|----------------------------------|
| 🆕 Create         | `INSERT`                  | 새로운 데이터 추가 (Add new data) |
| 🔍 Read           | `SELECT`                  | 데이터 조회 (Retrieve data)      |
| ✏️ Update         | `UPDATE`                  | 기존 데이터 수정 (Modify data)   |
| ❌ Delete         | `DELETE`                  | 데이터 삭제 (Remove data)        |

- 즉, 단순히 데이터 저장하는 장소가 아닌, 내가 원하는 방식으로 다룰 수 있음.

### 타입 지정
```SQL
CREATE TABLE users (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    age INTEGER,
    email TEXT UNIQUE
)
```
- **INTEGER, TEXT, REAL(실수), BOOLEAN** 등 다양한 데이터 타입
- **PRIMARY KEY** : 고유 식별자(행 구별해주는 고유 값)
- **NOT NULL, UNIQUE**: 제약조건

## sqlite3
- SQL 데이터베이스 도구
- 아이폰, 안드로이드, 브라우저 등에 내장될 만큼 가볍고 유용.
- 가볍고 설치 없이 바로 사용 가능.

### SQLite 사용법 in CodeSpace

```SQL
& sqlite3 favorites.db
sqlite> .mode csv
sqlite> .import favorites.csv favorites
sqlite> .schema 
sqlite> SELECT * FROM favorites;
sqlite> .quit
```

### 자주 쓰이는 SQL 문법
| 기능 (Function)      | 문법 예시 (SQL Syntax)                              | 설명 (Description)                          |
|----------------------|------------------------------------------------------|----------------------------------------------|
| 전체 조회             | `SELECT * FROM table;`                               | 테이블의 모든 데이터를 조회                 |
| 조건 조회             | `SELECT * FROM table WHERE column = 'X';`            | 특정 조건에 해당하는 데이터 조회           |
| LIKE 검색            | `SELECT * FROM table WHERE name LIKE '%na%';`        | 특정 문자열이 포함된 데이터 검색           |
| 정렬                 | `SELECT * FROM table ORDER BY column ASC/DESC;`      | 특정 컬럼을 기준으로 오름/내림차순 정렬    |
| 갯수 세기            | `SELECT COUNT(*) FROM table;`                        | 전체 행(row)의 개수 계산                    |
| 중복 제거            | `SELECT DISTINCT column FROM table;`                 | 중복을 제거한 고유한 값만 조회             |
| 그룹화               | `SELECT column, COUNT(*) FROM table GROUP BY column;`| 특정 컬럼 값별로 그룹화 후 집계             |
| 제한                 | `SELECT * FROM table LIMIT 5;`                       | 상위 5개 결과만 조회                        |
| 삭제                 | `DELETE FROM table WHERE 조건;`                      | 조건에 맞는 데이터 삭제                    |
| 수정                 | `UPDATE table SET column = '값' WHERE 조건;`         | 조건에 맞는 데이터 수정                    |

<br>

### 🎬 실생활 예시 (무슨 명령인지 맞춰보세요~~)
```SQL
SELECT title, COUNT(*) 
FROM favorites 
WHERE title LIKE '%Harry%' 
GROUP BY title 
ORDER BY COUNT(*) DESC 
LIMIT 3;
```

### 중요 개념 요약
- **관계형 데이터베이스**는 여러 테이블을 서로 연결해 관리할 수 있는 구조

- **SQL**은 데이터를 생성(C), 읽기(R), 수정(U), 삭제(D)하는 언어

- **SQLite**는 SQL을 가볍게 실행할 수 있는 도구 (설치 필요 없음)

- **SELECT + WHERE + ORDER BY + GROUP BY + LIMIT** = 데이터 필터링 & 정렬 핵심

# Django
- 게시글 하나 가져오는 것은 get 활용.
- db 조작은 모두 post method로.
- url-view-html 작성 루틴.
- form에 작성한 데이터는 request에 포함되어 온다. 그걸 GET 메서드를 통한다. request.GET.get() 만약 post를 쓸거면 다 바꿔야함.
- 안보고도 CRUD 다 할 수 있는 수준까지 갑시다.
- url에 데이터가 들어갈 수 있다. (GET) 검색과 페이지 요청 정도
- DB건드리면 무조건 post메서드로 보내라. 보안에 유리하다.
- 데이터를 생성(create)한다는건 DB에 직접 넣는데, 에러가 날 것이다. cfr~오류. 어떤 타입은 어떤 에러다 코드 보면 대략적으로 알 수 있음.
- CSRF token은 사이트간 요청 위조. 내가 로그인 했는데, 내 의지와 상관 없이 해킹범이 다른 컴퓨터에서 내가 한 것 처럼 쿠키 등을 이용했으면, (누른 척 했을 때) 방지 위해서 csrf_token을 실어서 보냄. 처음에 1이라고 보내줬는데 그게 왔어? 이렇게 보안을 체크. 발급이 되면 쿠키에 csrf_token을 저장. 서버에서 비교하는 것.
- 들어갔는데 값과 보이는 값이 다를 수 있음. 보이는 쿠키를 그대로 가져가 쓰면 뚫릴 수 있스니까. 
- 결론은 post를 사용하면 csrf_token을 같이 보낸다는 것.
- 작성된 DB를 어떤 페이지로 되돌려 보낼 때 쓰는게 redirect()
- 중요한건 redirect 한다고 해서 view함수를 호출하는게 아니라 url까지 가서 그 url이 view함수를 호출하는 것이다.
- Django는 너무 헤매면 안된다. method를 mehtod로 쓰는 실수 많이 한다. 
- 캐시: 임시 저장 공간. 네이버 처음 들어갈 때 오래걸리지만 그 다음부터 새로고침 하면 금방금방 고쳐짐. 캐시로 임시저장해놨기 때문이다. 
